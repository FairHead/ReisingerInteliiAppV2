<?xml version="1.0" encoding="utf-8" ?>
<ContentView
    x:Class="ReisingerIntelliApp_V4.Components.PlacedDeviceControl"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:ReisingerIntelliApp_V4.Converters"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    x:Name="placedDeviceControl"
    BackgroundColor="Transparent">

    <ContentView.Resources>
        <ResourceDictionary>
            <converters:BoolToOpenCloseConverter x:Key="BoolToOpenCloseConverter" />
        </ResourceDictionary>
    </ContentView.Resources>

    <!--  Main Container - matches Figma design dimensions  -->
    <Grid
        HeightRequest="180"
        HorizontalOptions="Start"
        VerticalOptions="Start"
        WidthRequest="160">

        <!--  Device Display Grid  -->
    <Grid x:Name="DeviceGrid" BackgroundColor="Transparent" ZIndex="3">

            <!--  Scale Plus Button (Top Left)  -->
            <ImageButton
                x:Name="ScalePlusDeviceButton"
                Grid.Row="0"
                Margin="8,0,0,0"
                BackgroundColor="{StaticResource PlacedDeviceAddButton}"
                Clicked="OnScalePlusClicked"
                CornerRadius="14"
                HorizontalOptions="Start"
                MaximumHeightRequest="25"
                MaximumWidthRequest="25"
                Source="plus.svg"
                VerticalOptions="Start" />

            <!--  Scale Minus Button (Top Right)  -->
            <ImageButton
                x:Name="ScaleMinusDeviceButton"
                Grid.Row="0"
                Margin="0,0,8,0"
                BackgroundColor="{StaticResource PlacedDeviceAddButton}"
                Clicked="OnScaleMinusClicked"
                CornerRadius="14"
                HorizontalOptions="End"
                MaximumHeightRequest="25"
                MaximumWidthRequest="25"
                Source="minus.svg"
                VerticalOptions="Start" />

            <!--  Move Device Button (Bottom Right)  -->
            <ImageButton
                Grid.Row="0"
                Margin="0,0,8,8"
                BackgroundColor="{StaticResource PlacedDeviceAddButton}"
                Clicked="OnMoveDeviceClicked"
                CornerRadius="14"
                HorizontalOptions="End"
                MaximumHeightRequest="25"
                MaximumWidthRequest="25"
                Source="move.svg"
                VerticalOptions="End" />

        </Grid>

        <!--  Move Buttons Container (Hidden by default)  -->
    <Grid x:Name="ArrowButtonsContainer" IsVisible="False" ZIndex="2">

            <!--  Move Up Button  -->
            <ImageButton
                Margin="0,0,0,0"
                BackgroundColor="{StaticResource PlacedDeviceAddButton}"
                Clicked="OnMoveUpClicked"
                CornerRadius="12"
                HorizontalOptions="Center"
                MaximumHeightRequest="20"
                MaximumWidthRequest="20"
                Source="arrow_up.svg"
                VerticalOptions="Start" />

            <!--  Move Down Button  -->
            <ImageButton
                Margin="0,0,0,0"
                BackgroundColor="{StaticResource PlacedDeviceAddButton}"
                Clicked="OnMoveDownClicked"
                CornerRadius="12"
                HorizontalOptions="Center"
                MaximumHeightRequest="20"
                MaximumWidthRequest="20"
                Source="arrow_down.svg"
                VerticalOptions="End" />

            <!--  Move Left Button  -->
            <ImageButton
                Margin="0,0,0,0"
                BackgroundColor="{StaticResource PlacedDeviceAddButton}"
                Clicked="OnMoveLeftClicked"
                CornerRadius="12"
                HorizontalOptions="Start"
                MaximumHeightRequest="20"
                MaximumWidthRequest="20"
                Source="arrow_left.svg"
                VerticalOptions="Center" />

            <!--  Move Right Button  -->
            <ImageButton
                Margin="0,0,0,0"
                BackgroundColor="{StaticResource PlacedDeviceAddButton}"
                Clicked="OnMoveRightClicked"
                CornerRadius="12"
                HorizontalOptions="End"
                MaximumHeightRequest="20"
                MaximumWidthRequest="20"
                Source="arrow_right.svg"
                VerticalOptions="Center" />

        </Grid>

        <!--  Feature Card (Main Device Info)  -->
        <Border
            BackgroundColor="#1E1E1E"
            HeightRequest="156"
            HorizontalOptions="Fill"
            VerticalOptions="End"
            ZIndex="1">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="16" />
            </Border.StrokeShape>

            <Grid RowDefinitions="Auto,*,Auto">

                <!--  Device Info Container (Top)  -->
                <StackLayout
                    Grid.Row="0"
                    Margin="0,9,0,0"
                    HorizontalOptions="Center"
                    Spacing="4"
                    VerticalOptions="Start">

                    <!--  Device Name  -->
                    <Label
                        FontFamily="SpaceMonoBold"
                        FontSize="12"
                        HorizontalOptions="Center"
                        LineBreakMode="TailTruncation"
                        MaxLines="1"
                        Text="{Binding Name}"
                        TextColor="{StaticResource PlacedDeviceText}"
                        TextDecorations="Underline" />

                    <!--  IP Address  -->
                    <Label
                        FontFamily="SpaceMonoRegular"
                        FontSize="10"
                        HorizontalOptions="Center"
                        LineBreakMode="TailTruncation"
                        MaxLines="1"
                        Text="{Binding IpAddress}"
                        TextColor="{StaticResource PlacedDeviceTextSecondary}"
                        TextDecorations="Underline" />
                </StackLayout>

                <!--  Spacer for center area  -->
                <BoxView Grid.Row="1" BackgroundColor="Transparent" />

                <!--  Button Row at Bottom  -->
                <Grid
                    Grid.Row="1"
                    Margin="10"
                    ColumnDefinitions="*,Auto,*"
                    HorizontalOptions="Center"
                    RowDefinitions="Auto,*,Auto"
                    VerticalOptions="Center">

                    <!--  Delete Device Button (Left)  -->
                    <ImageButton
                        Grid.Row="2"
                        Grid.RowSpan="1"
                        Grid.Column="0"
                        Aspect="Center"
                        BackgroundColor="{StaticResource PlacedDeviceDeleteButton}"
                        Clicked="OnDeleteDeviceClicked"
                        CornerRadius="22"
                        HorizontalOptions="Center"
                        MinimumHeightRequest="35"
                        MinimumWidthRequest="35"
                        Source="bin.svg"
                        VerticalOptions="Center" />

                    <!--  Large Open/Close Button (Center)  -->
                    <ImageButton
                        Grid.Row="1"
                        Grid.RowSpan="1"
                        Grid.Column="1"
                        Margin="0,0,0,0"
                        BackgroundColor="{StaticResource PlacedDeviceConfigButton}"
                        Clicked="OnToggleDoorClicked"
                        CornerRadius="30"
                        HeightRequest="60"
                        HorizontalOptions="Center"
                        VerticalOptions="Center"
                        WidthRequest="60">
                        <ImageButton.Source>
                            <FontImageSource
                                FontFamily="SpaceMonoBold"
                                Glyph="{Binding IsDoorOpen, Converter={StaticResource BoolToOpenCloseConverter}}"
                                Size="14"
                                Color="Black" />
                        </ImageButton.Source>
                    </ImageButton>

                    <!--  Move Device Button (Right)  -->
                    <ImageButton
                        Grid.Row="2"
                        Grid.RowSpan="1"
                        Grid.Column="2"
                        Aspect="Center"
                        BackgroundColor="{StaticResource PlacedDeviceMoveButton}"
                        Clicked="OnMoveDeviceClicked"
                        CornerRadius="22"
                        HorizontalOptions="Center"
                        MinimumHeightRequest="35"
                        MinimumWidthRequest="35"
                        Source="move.svg"
                        VerticalOptions="Center" />
                </Grid>
            </Grid>
        </Border>

        <!--  Selection indicator  -->
        <Border
            BackgroundColor="Transparent"
            HorizontalOptions="Fill"
            IsVisible="{Binding IsSelected}"
            Stroke="Yellow"
            StrokeThickness="3"
            VerticalOptions="Fill"
            InputTransparent="True"
            ZIndex="4">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="18" />
            </Border.StrokeShape>
        </Border>

    </Grid>
</ContentView>
